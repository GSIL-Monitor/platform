(function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("undefined"==typeof jQuery?window.Zepto:jQuery)})(function(c){"use strict";function a(a){var b=a.data;a.isDefaultPrevented()||(a.preventDefault(),c(a.target).ajaxSubmit(b))}function b(a){var b=a.target,d=c(b);if(!d.is("[type=submit],[type=image]")){var e=d.closest("[type=submit]");if(0===e.length)return;b=e[0]}var f=this;if(f.clk=b,"image"==b.type)if(void 0!==a.offsetX)f.clk_x=a.offsetX,f.clk_y=a.offsetY;else if("function"==typeof c.fn.offset){var g=d.offset();f.clk_x=a.pageX-g.left,f.clk_y=a.pageY-g.top}else f.clk_x=a.pageX-b.offsetLeft,f.clk_y=a.pageY-b.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)}function d(){if(c.fn.ajaxSubmit.debug){var a="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(a):window.opera&&window.opera.postError&&window.opera.postError(a)}}var e={fileapi:c("<input type='file'/>").get(0).files!==void 0,formdata:window.FormData!==void 0},f=!!c.fn.prop;c.fn.attr2=function(){if(!f)return this.attr.apply(this,arguments);var a=this.prop.apply(this,arguments);return a&&a.jquery||"string"==typeof a?a:this.attr.apply(this,arguments)},c.fn.ajaxSubmit=function(b){function g(a){var d,e,f=c.param(a,b.traditional).split("&"),g=f.length,h=[];for(d=0;d<g;d++)f[d]=f[d].replace(/\+/g," "),e=f[d].split("="),h.push([decodeURIComponent(e[0]),decodeURIComponent(e[1])]);return h}function h(d){for(var a=new FormData,e=0;e<d.length;e++)a.append(d[e].name,d[e].value);if(b.extraData){var f=g(b.extraData);for(e=0;e<f.length;e++)f[e]&&a.append(f[e][0],f[e][1])}b.data=null;var h=c.extend(!0,{},c.ajaxSettings,b,{contentType:!1,processData:!1,cache:!1,type:j||"POST"});b.uploadProgress&&(h.xhr=function(){var a=c.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(a){var c=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(c=Math.ceil(100*(d/e))),b.uploadProgress(a,d,e,c)},!1),a}),h.data=null;var k=h.beforeSend;return h.beforeSend=function(c,d){d.data=b.formData?b.formData:a,k&&k.call(this,c,d)},c.ajax(h)}function i(e){function a(a){var b=null;try{a.contentWindow&&(b=a.contentWindow.document)}catch(a){d("cannot get iframe.contentWindow document: "+a)}if(b)return b;try{b=a.contentDocument?a.contentDocument:a.document}catch(c){d("cannot get iframe.contentDocument: "+c),b=a.document}return b}function h(){function b(){try{var c=a(u).readyState;d("state = "+c),c&&"uninitialized"==c.toLowerCase()&&setTimeout(b,50)}catch(a){d("Server abort: ",a," (",a.name,")"),k(2),z&&clearTimeout(z),z=void 0}}var e=o.attr2("target"),f=o.attr2("action"),g=o.attr("enctype")||o.attr("encoding")||"multipart/form-data";A.setAttribute("target",r),(!j||/post/i.test(j))&&A.setAttribute("method","POST"),f!=p.url&&A.setAttribute("action",p.url),p.skipEncodingOverride||j&&!/post/i.test(j)||o.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(z=setTimeout(function(){y=!0,k(1)},p.timeout));var h=[];try{if(p.extraData)for(var i in p.extraData)p.extraData.hasOwnProperty(i)&&(c.isPlainObject(p.extraData[i])&&p.extraData[i].hasOwnProperty("name")&&p.extraData[i].hasOwnProperty("value")?h.push(c("<input type=\"hidden\" name=\""+p.extraData[i].name+"\">").val(p.extraData[i].value).appendTo(A)[0]):h.push(c("<input type=\"hidden\" name=\""+i+"\">").val(p.extraData[i]).appendTo(A)[0]));p.iframeTarget||t.appendTo("body"),u.attachEvent?u.attachEvent("onload",k):u.addEventListener("load",k,!1),setTimeout(b,15);try{A.submit()}catch(a){var l=document.createElement("form").submit;l.apply(A)}}finally{A.setAttribute("action",f),A.setAttribute("enctype",g),e?A.setAttribute("target",e):o.removeAttr("target"),c(h).remove()}}function k(f){if(!(v.aborted||G)){if(F=a(u),F||(d("cannot access response document"),f=2),1===f&&v)return v.abort("timeout"),void B.reject(v,"timeout");if(2==f&&v)return v.abort("server abort"),void B.reject(v,"error","server abort");if(F&&F.location.href!=p.iframeSrc||y){u.detachEvent?u.detachEvent("onload",k):u.removeEventListener("load",k,!1);var g,h="success";try{if(y)throw"timeout";var i="xml"==p.dataType||F.XMLDocument||c.isXMLDoc(F);if(d("isXml="+i),!i&&window.opera&&(null===F.body||!F.body.innerHTML)&&--H)return d("requeing onLoad callback, DOM not available"),void setTimeout(k,250);var j=F.body?F.body:F.documentElement;v.responseText=j?j.innerHTML:null,v.responseXML=F.XMLDocument?F.XMLDocument:F,i&&(p.dataType="xml"),v.getResponseHeader=function(a){var b={"content-type":p.dataType};return b[a.toLowerCase()]},j&&(v.status=+j.getAttribute("status")||v.status,v.statusText=j.getAttribute("statusText")||v.statusText);var l=(p.dataType||"").toLowerCase(),m=/(json|script|text)/.test(l);if(m||p.textarea){var n=F.getElementsByTagName("textarea")[0];if(n)v.responseText=n.value,v.status=+n.getAttribute("status")||v.status,v.statusText=n.getAttribute("statusText")||v.statusText;else if(m){var o=F.getElementsByTagName("pre")[0],r=F.getElementsByTagName("body")[0];o?v.responseText=o.textContent?o.textContent:o.innerText:r&&(v.responseText=r.textContent?r.textContent:r.innerText)}}else"xml"==l&&!v.responseXML&&v.responseText&&(v.responseXML=I(v.responseText));try{E=K(v,l,p)}catch(a){h="parsererror",v.error=g=a||h}}catch(a){d("error caught: ",a),h="error",v.error=g=a||h}v.aborted&&(d("upload aborted"),h=null),v.status&&(h=200<=v.status&&300>v.status||304===v.status?"success":"error"),"success"==h?(p.success&&p.success.call(p.context,E,"success",v),B.resolve(v.responseText,"success",v),q&&c.event.trigger("ajaxSuccess",[v,p])):h&&(void 0===g&&(g=v.statusText),p.error&&p.error.call(p.context,v,h,g),B.reject(v,"error",g),q&&c.event.trigger("ajaxError",[v,p,g])),q&&c.event.trigger("ajaxComplete",[v,p]),q&&! --c.active&&c.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,v,h),G=!0,p.timeout&&clearTimeout(z),setTimeout(function(){p.iframeTarget?t.attr("src",p.iframeSrc):t.remove(),v.responseXML=null},100)}}}var l,m,p,q,r,t,u,v,w,x,y,z,A=o[0],B=c.Deferred();if(B.abort=function(a){v.abort(a)},e)for(m=0;m<s.length;m++)l=c(s[m]),f?l.prop("disabled",!1):l.removeAttr("disabled");if(p=c.extend(!0,{},c.ajaxSettings,b),p.context=p.context||p,r="jqFormIO"+new Date().getTime(),p.iframeTarget?(t=c(p.iframeTarget),x=t.attr2("name"),x?r=x:t.attr2("name",r)):(t=c("<iframe name=\""+r+"\" src=\""+p.iframeSrc+"\" />"),t.css({position:"absolute",top:"-1000px",left:"-1000px"})),u=t[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(a){var b="timeout"===a?"timeout":"aborted";d("aborting upload... "+b),this.aborted=1;try{u.contentWindow.document.execCommand&&u.contentWindow.document.execCommand("Stop")}catch(a){}t.attr("src",p.iframeSrc),v.error=b,p.error&&p.error.call(p.context,v,b,a),q&&c.event.trigger("ajaxError",[v,p,b]),p.complete&&p.complete.call(p.context,v,b)}},q=p.global,q&&0==c.active++&&c.event.trigger("ajaxStart"),q&&c.event.trigger("ajaxSend",[v,p]),p.beforeSend&&!1===p.beforeSend.call(p.context,v,p))return p.global&&c.active--,B.reject(),B;if(v.aborted)return B.reject(),B;w=A.clk,w&&(x=w.name,x&&!w.disabled&&(p.extraData=p.extraData||{},p.extraData[x]=w.value,"image"==w.type&&(p.extraData[x+".x"]=A.clk_x,p.extraData[x+".y"]=A.clk_y)));var C=c("meta[name=csrf-token]").attr("content"),D=c("meta[name=csrf-param]").attr("content");D&&C&&(p.extraData=p.extraData||{},p.extraData[D]=C),p.forceSync?h():setTimeout(h,10);var E,F,G,H=50,I=c.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=new DOMParser().parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},J=c.parseJSON||function(a){return window.eval("("+a+")")},K=function(a,b,d){var e=a.getResponseHeader("content-type")||"",f="xml"===b||!b&&0<=e.indexOf("xml"),g=f?a.responseXML:a.responseText;return f&&"parsererror"===g.documentElement.nodeName&&c.error&&c.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,b)),"string"==typeof g&&("json"===b||!b&&0<=e.indexOf("json")?g=J(g):("script"===b||!b&&0<=e.indexOf("javascript"))&&c.globalEval(g)),g};return B}if(!this.length)return d("ajaxSubmit: skipping submit process - no element selected"),this;var j,l,m,o=this;"function"==typeof b?b={success:b}:void 0===b&&(b={}),j=b.type||this.attr2("method"),l=b.url||this.attr2("action"),m="string"==typeof l?c.trim(l):"",m=m||window.location.href||"",m&&(m=(m.match(/^([^#]+)/)||[])[1]),b=c.extend(!0,{url:m,success:c.ajaxSettings.success,type:j||c.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b);var n={};if(this.trigger("form-pre-serialize",[this,b,n]),n.veto)return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&!1===b.beforeSerialize(this,b))return d("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=b.traditional;void 0===p&&(p=c.ajaxSettings.traditional);var r,s=[],t=this.formToArray(b.semantic,s);if(b.data&&(b.extraData=b.data,r=c.param(b.data,p)),b.beforeSubmit&&!1===b.beforeSubmit(t,this,b))return d("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[t,this,b,n]),n.veto)return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var a=c.param(t,p);r&&(a=a?a+"&"+r:r),"GET"==b.type.toUpperCase()?(b.url+=(0<=b.url.indexOf("?")?"&":"?")+a,b.data=null):b.data=a;var u=[];if(b.resetForm&&u.push(function(){o.resetForm()}),b.clearForm&&u.push(function(){o.clearForm(b.includeHidden)}),!b.dataType&&b.target){var v=b.success||function(){};u.push(function(a){var d=b.replaceTarget?"replaceWith":"html";c(b.target)[d](a).each(v,arguments)})}else b.success&&u.push(b.success);if(b.success=function(a,c,d){for(var e=b.context||this,f=0,g=u.length;f<g;f++)u[f].apply(e,[a,c,d||o,o])},b.error){var w=b.error;b.error=function(a,c,d){var e=b.context||this;w.apply(e,[a,c,d,o])}}if(b.complete){var x=b.complete;b.complete=function(a,c){var d=b.context||this;x.apply(d,[a,c,o])}}var y=c("input[type=file]:enabled",this).filter(function(){return""!==c(this).val()}),z=0<y.length,A="multipart/form-data",B=o.attr("enctype")==A||o.attr("encoding")==A,C=e.fileapi&&e.formdata;d("fileAPI :"+C);var D;!1!==b.iframe&&(b.iframe||(z||B)&&!C)?b.closeKeepAlive?c.get(b.closeKeepAlive,function(){D=i(t)}):D=i(t):(z||B)&&C?D=h(t):D=c.ajax(b),o.removeData("jqxhr").data("jqxhr",D);for(var E=0;E<s.length;E++)s[E]=null;return this.trigger("form-submit-notify",[this,b]),this},c.fn.ajaxForm=function(e){if(e=e||{},e.delegation=e.delegation&&c.isFunction(c.fn.on),!e.delegation&&0===this.length){var f={s:this.selector,c:this.context};return!c.isReady&&f.s?(d("DOM not ready, queuing ajaxForm"),c(function(){c(f.s,f.c).ajaxForm(e)}),this):(d("terminating; zero elements found by selector"+(c.isReady?"":" (DOM not ready)")),this)}return e.delegation?(c(document).off("submit.form-plugin",this.selector,a).off("click.form-plugin",this.selector,b).on("submit.form-plugin",this.selector,e,a).on("click.form-plugin",this.selector,e,b),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,a).bind("click.form-plugin",e,b)},c.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},c.fn.formToArray=function(b,d){var f=[];if(0===this.length)return f;var a,g=this[0],h=this.attr("id"),k=b?g.getElementsByTagName("*"):g.elements;if(k&&!/MSIE [678]/.test(navigator.userAgent)&&(k=c(k).get()),h&&(a=c(":input[form=\""+h+"\"]").get(),a.length&&(k=(k||[]).concat(a))),!k||!k.length)return f;var l,m,o,p,q,r,s;for(l=0,r=k.length;l<r;l++)if(q=k[l],o=q.name,o&&!q.disabled){if(b&&g.clk&&"image"==q.type){g.clk==q&&(f.push({name:o,value:c(q).val(),type:q.type}),f.push({name:o+".x",value:g.clk_x},{name:o+".y",value:g.clk_y}));continue}if(p=c.fieldValue(q,!0),p&&p.constructor==Array)for(d&&d.push(q),m=0,s=p.length;m<s;m++)f.push({name:o,value:p[m]});else if(e.fileapi&&"file"==q.type){d&&d.push(q);var t=q.files;if(t.length)for(m=0;m<t.length;m++)f.push({name:o,value:t[m],type:q.type});else f.push({name:o,value:"",type:q.type})}else null!==p&&"undefined"!=typeof p&&(d&&d.push(q),f.push({name:o,value:p,type:q.type,required:q.required}))}if(!b&&g.clk){var u=c(g.clk),w=u[0];o=w.name,o&&!w.disabled&&"image"==w.type&&(f.push({name:o,value:u.val()}),f.push({name:o+".x",value:g.clk_x},{name:o+".y",value:g.clk_y}))}return f},c.fn.formSerialize=function(a){return c.param(this.formToArray(a))},c.fn.fieldSerialize=function(b){var d=[];return this.each(function(){var a=this.name;if(a){var e=c.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)d.push({name:a,value:e[f]});else null!==e&&"undefined"!=typeof e&&d.push({name:this.name,value:e})}}),c.param(d)},c.fn.fieldValue=function(a){for(var b=[],d=0,e=this.length;d<e;d++){var f=this[d],g=c.fieldValue(f,a);null!==g&&"undefined"!=typeof g&&(g.constructor!=Array||g.length)&&(g.constructor==Array?c.merge(b,g):b.push(g))}return b},c.fieldValue=function(b,d){var e=b.name,f=b.type,g=b.tagName.toLowerCase();if(void 0===d&&(d=!0),d&&(!e||b.disabled||"reset"==f||"button"==f||("checkbox"==f||"radio"==f)&&!b.checked||("submit"==f||"image"==f)&&b.form&&b.form.clk!=b||"select"==g&&-1==b.selectedIndex))return null;if("select"==g){var h=b.selectedIndex;if(0>h)return null;for(var j,k=[],a=b.options,l="select-one"==f,m=l?h+1:a.length,n=l?h:0;n<m;n++)if(j=a[n],j.selected){var o=j.value;if(o||(o=j.attributes&&j.attributes.value&&!j.attributes.value.specified?j.text:j.value),l)return o;k.push(o)}return k}return c(b).val()},c.fn.clearForm=function(a){return this.each(function(){c("input,select,textarea",this).clearFields(a)})},c.fn.clearFields=c.fn.clearInputs=function(a){var b=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();b.test(d)||"textarea"==e?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==e?this.selectedIndex=-1:"file"==d?/MSIE/.test(navigator.userAgent)?c(this).replaceWith(c(this).clone(!0)):c(this).val(""):a&&(!0===a&&/hidden/.test(d)||"string"==typeof a&&c(this).is(a))&&(this.value="")})},c.fn.resetForm=function(){return this.each(function(){"function"!=typeof this.reset&&("object"!=typeof this.reset||this.reset.nodeType)||this.reset()})},c.fn.enable=function(a){return void 0===a&&(a=!0),this.each(function(){this.disabled=!a})},c.fn.selected=function(a){return void 0===a&&(a=!0),this.each(function(){var b=this.type;if("checkbox"==b||"radio"==b)this.checked=a;else if("option"==this.tagName.toLowerCase()){var d=c(this).parent("select");a&&d[0]&&"select-one"==d[0].type&&d.find("option").selected(!1),this.selected=a}})},c.fn.ajaxSubmit.debug=!1});